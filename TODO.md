# TODO - LSIF Indexer 改善項目

## 🚨 重要度: 高

### 1. 大規模プロジェクトのインデックス性能改善
- **問題**: 100ファイル以上のプロジェクトで初回インデックスが30秒以上かかる
- **原因**: 
  - 並列処理のオーバーヘッド（Mutex競合）
  - 正規表現のコンパイルコスト
  - ファイルI/Oのボトルネック
- **対策案**:
  - [ ] 正規表現のプリコンパイルとキャッシュ
  - [ ] lock-freeデータ構造の採用（dashmap等）
  - [ ] ファイルI/Oの非同期化（tokio）
  - [ ] バッチ処理サイズの最適化

### 2. 定義へのジャンプ機能の修正
- **問題**: シンボル位置の特定が正確でない
- **原因**: フォールバックインデクサーの位置情報が不正確
- **対策案**:
  - [ ] 行・列番号の正確な計算ロジックの実装
  - [ ] tree-sitterによる正確な構文解析の導入
  - [ ] LSPサーバーとの連携強化

### 3. 並列処理の最適化
- **問題**: 並列処理が期待した性能向上をもたらさない
- **現状**: `--parallel`オプションは実装済みだが遅い
- **対策案**:
  - [ ] rayonのチャンクサイズを動的調整
  - [ ] CPU親和性の設定
  - [ ] ワークスティーリングの最適化
  - [ ] プロファイリングによるボトルネック特定

## 📝 重要度: 中

### 4. 未使用コード検出の実装
- **現状**: "currently being refactored"で使用不可
- **必要な実装**:
  - [ ] シンボル参照グラフの構築
  - [ ] エントリーポイントからの到達可能性解析
  - [ ] publicシンボルの特別扱い
  - [ ] テストコードの除外オプション

### 5. LSPサーバー統合の改善
- **問題**: LSPサーバーの起動に時間がかかる
- **対策案**:
  - [ ] LSPサーバーのプール管理
  - [ ] 言語別の最適な設定
  - [ ] タイムアウト値の調整
  - [ ] フォールバックの高速化

### 6. メモリ使用量の最適化
- **問題**: 大規模プロジェクトでメモリ使用量が多い
- **対策案**:
  - [ ] String interningの強化
  - [ ] 不要なクローンの削除
  - [ ] メモリプールの実装
  - [ ] インクリメンタルGCの検討

## ✨ 重要度: 低（機能追加）

### 7. 新機能の追加
- [ ] **型階層の表示**: インターフェース/トレイトの実装関係
- [ ] **リファクタリング支援**: シンボルリネーム、Extract Method
- [ ] **グラフクエリの強化**: Cypher風クエリ言語の完全実装
- [ ] **プロジェクト間参照**: 依存ライブラリのシンボル解決
- [ ] **インデックスのマージ**: 複数プロジェクトの統合インデックス

### 8. 言語サポートの拡充
- [ ] **C/C++**: clangdとの統合
- [ ] **Java**: jdtlsとの統合
- [ ] **JavaScript/TypeScript**: パフォーマンス改善
- [ ] **Python**: pyright/pylspの最適化
- [ ] **Go**: goplsの完全サポート

### 9. UI/UXの改善
- [ ] **プログレスバー**: より詳細な進捗表示
- [ ] **カラー出力**: 結果の視認性向上
- [ ] **インタラクティブモード**: TUIベースの対話的操作
- [ ] **Web UI**: ブラウザベースのインデックス閲覧
- [ ] **VS Code拡張**: エディタ統合

## 🔧 技術的改善

### 10. コード品質の向上
- [ ] **テストカバレッジ**: 現在32% → 目標70%以上
- [ ] **ドキュメント**: APIドキュメントの充実
- [ ] **エラーハンドリング**: より詳細なエラーメッセージ
- [ ] **ロギング**: 構造化ログの導入
- [ ] **ベンチマーク**: 継続的パフォーマンス測定

### 11. CI/CDの改善
- [ ] **GitHub Actions**: 自動テスト・ビルド
- [ ] **リリース自動化**: cargo-releaseの設定
- [ ] **クロスプラットフォームビルド**: Windows/macOS対応
- [ ] **Docker化**: コンテナイメージの提供
- [ ] **パフォーマンス回帰テスト**: 自動性能測定

## 📊 現在の達成状況

### ✅ 完了済み
- 差分インデックスの実装（0.5秒以内で動作）
- ハッシュベースの変更検知
- フォールバックインデクサー
- 基本的な検索機能
- CLIインターフェース

### 🚧 作業中
- 並列処理の最適化
- 大規模プロジェクト対応

### 📈 パフォーマンス目標

| メトリクス | 現在値 | 目標値 |
|-----------|--------|--------|
| 初回インデックス（100ファイル） | >30秒 | <5秒 |
| 差分インデックス（1ファイル） | 0.5秒 | 0.1秒 |
| メモリ使用量（1000ファイル） | 未測定 | <500MB |
| 検索レスポンス | 未測定 | <50ms |

## 優先順位

1. **緊急**: 大規模プロジェクトのインデックス性能
2. **重要**: 定義ジャンプの精度向上
3. **通常**: 未使用コード検出、LSP改善
4. **低**: 新機能追加、言語サポート拡充

---

*Last updated: 2025-09-01*