# カバレッジ分析レポート

## 現在の状況
- **総合カバレッジ**: 44.50% (目標: 80%)
- **テスト済み行数**: 5,625行 / 12,641行

## 優先対応事項

### 1. 不要コードの削除候補
以下のモジュールは使用されていないため、削除を検討：
- `cli/ultra_fast_storage.rs` (247行, 0%)
- `cli/optimized_incremental.rs` (190行, 0%)  
- `core/enhanced_graph.rs` (254行, 0%)

削除により約691行削減、カバレッジが約3%向上見込み。

### 2. 重要モジュールのテスト追加（優先度高）

#### CLI系（実際に使用中、0%）
- `cli/simple_cli.rs` (717行)
  - メインCLIインターフェース
  - コマンドラインパーサーとコマンド実行
  - **必要なテスト**: コマンドパース、各コマンドの実行テスト

- `cli/storage.rs` (54行)
  - インデックスストレージの基本インターフェース
  - **必要なテスト**: save/load操作のテスト

- `cli/differential_indexer.rs`
  - 差分インデックス機能
  - **必要なテスト**: 差分検出、インクリメンタル更新テスト

#### LSP系（重要機能、0-12%）
- `cli/lsp_commands.rs` (0%)
  - LSPコマンド実装
  - **必要なテスト**: 各LSPコマンドの単体テスト

- `cli/lsp_client.rs` (5%)
  - LSPクライアント実装
  - **必要なテスト**: 接続、メッセージ送受信テスト

- `cli/lsp_adapter.rs` (12%)
  - LSPアダプター
  - **必要なテスト**: 言語サーバー統合テスト

### 3. カバレッジ向上計画

#### フェーズ1: 不要コード削除（+3%）
- 未使用モジュール3つを削除
- 予想カバレッジ: 44.50% → 47.50%

#### フェーズ2: CLI系テスト（+15%）
- `simple_cli.rs`のテスト追加
- `storage.rs`のテスト追加
- `differential_indexer.rs`のテスト追加
- 予想カバレッジ: 47.50% → 62.50%

#### フェーズ3: LSP系テスト（+10%）
- LSP関連モジュールのテスト追加
- モックサーバーを使用した統合テスト
- 予想カバレッジ: 62.50% → 72.50%

#### フェーズ4: 並列処理系の改善（+7.5%）
- `parallel_optimized.rs`のテスト追加
- `cached_storage.rs`のテスト強化
- 予想カバレッジ: 72.50% → 80.00%

## テスト戦略

### 単体テスト
- 各モジュールの公開APIを網羅
- エッジケースとエラーハンドリング
- モックを活用した依存関係の分離

### 統合テスト
- CLIコマンドのE2Eテスト
- LSPプロトコルの統合テスト
- ファイルシステム操作の実際のテスト

### パフォーマンステスト
- 大規模プロジェクトでのインデックス作成
- 差分インデックスの性能測定
- メモリ使用量の監視

## 次のアクション

1. **即実行**: 不要モジュール削除（30分）
2. **短期**: CLI系テスト追加（2-3時間）
3. **中期**: LSP系テスト追加（3-4時間）
4. **長期**: 並列処理系の最適化とテスト（2-3時間）

合計作業時間: 約8-11時間で80%カバレッジ達成可能